---
reviewed: 2024-08-26 13:16:08
title: Updating Craft CMS
naviTitle: Updating
navigation.excerpt: Opinionated guide to upgrade Craft
lead: Always use the latest software version for security reasons. Here are some strategies to best keep Craft CMS up-to-date.
sidebar: craft-cms
nextNav: true
siblings: Craft CMS guides
head:
  meta:
    - name: keywords
      content: craft, craftCMS, setup, install-guide
---

## Update your local development environment first

Your [local development environment](/3.dev/19.how-to/1.local-development.md) is where changes are applied and tested first. Please update your local Craft CMS installation first and apply updates by deploying as a second step. That way you make sure that your environments are in sync.

The `config/general.php` file we use in [our setup guide](/2.guides/3.craft/1.setup.md) sets `allowUpdates` to `false`: this prevents plugin and Craft core updates from the Craft Control Panel in the `production` app environment.

It's a common mistake we see. Make sure your environments are in sync and you don't mess with updates and installing plugins on the app environment itself.

Here are the options to update Craft CMS and Craft plugins. Make sure to also check out the [official guides on the topic](https://craftcms.com/docs/updating.html).

### A) Update Craft using the Control Panel – simple

1. Login to the Craft CMS Control Panel of your local Craft installation
2. Go to Utilities > Updates
3. Click the "Update all" button

This will update your **local** development environment to the latest versions of Craft CMS as well as all plugins. After testing changes, deploy updates to your production App (see below).

### B) Update Craft using the Craft CLI – advanced

Run the following command in the terminal on your computer **locally** in the root folder of the Craft project:

```shell
./craft update all
```

This will update Craft, as well as all dependencies. For a dry run just type `./craft update`, that will list the available updates.

## Deploying Craft updates

After you have tested the updates locally you can deploy them to your app environment at fortrabbit. Here are your options:

### A) Deploying updates with Git

1. Add and commit the local changes (`composer.json`, `composer.lock`, `project.yaml` …)
2. Deploy the changes by `git push` to trigger deployment

During the [Git deployment](/3.dev/2.deployment/3.build-commands.md) `composer install` will likely run automatically. This way your local Composer changes get applied on the remote.

### B) Uploading updates with SSH/SFTP based workflows

Continuous development with an SFTP workflow is a hassle. One strategy is to upload the changed files from local to the App. Another strategy is to re-run the very same steps that have been done locally on the App itself.

## Database migrations

In most cases when updating a database migration is required. This will upgrade the database table structure to match the latest updates. It will be carried out when running the updates locally. But it's an extra step required to be done with your fortrabbit app environment. All essential Craft CMS settings are stored in the `project.yaml` files.

Here are your options to run migrations:

### A) Database migrations as a build step (recommended)

<!-- TODO: Test and review this section!! -->

When you have chosen Craft CMS in the [software preset](/1.platform/02.concepts/05.software-templates.md) while creating the app environment, the following two commands are part of your [deployment build steps](/3.dev/2.deployment/3.build-commands.md).

```shell
php craft project-config/sync
php craft migrate/all
```

### B) Craft Copy and Craft auto-migrate

<!--
TODO:
Review if we still want to recommend the plugin here and if it still works. We can add the two auto-migrate commands as a standard deploy step if Craft CMS is chosen.
-->

We have also created a little auto-migrate package - [see it on GitHub](https://github.com/fortrabbit/craft-auto-migrate) - which triggers `migrate/all` and `project-config/sync` every time `composer install` runs, which means it runs every time you deploy using git.

```shell
# Install the package (locally)
$ composer require fortrabbit/craft-auto-migrate
```

With that in place, every time you deploy your code, database and project config changes will be applied. If no changes are required, nothing happens, so it is safe to run all the time. Just make sure to test your upgrades and migrations locally first. The package is also dependency of our [Craft Copy](https://github.com/fortrabbit/craft-copy) deployment tool plugin. So when you have that installed, it will always run on `git push` which is the equivalent to `./craft copy/code/up` - one of the commands the plugin provides.

### C) Trigger a database migration by visiting the Control Panel URL

After applying updates on your fortrabbit Craft App, you might see a "Service unavailable" message. Visit the control panel URL ([{{app-env-id}}.frbit.app/admin](https://{{app-env-id}}.frbit.app/admin) or whatever you have set) and you might see a message saying that database changes need to applied. Click the "apply" button to run the migration manually.

### D) Manually run database migrations on the App via Craft CLI

You can trigger the changes via the Craft CLI in the terminal via [SSH](/3.dev/01.code-access/3.ssh.md):

```shell
# After being logged in to the app environment
php craft migrate/all
php craft project-config/apply
```
