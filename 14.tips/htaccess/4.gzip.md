---
reviewed:    2023-08-31 14:27:02
title:       GZIP with .htaccess
naviTitle:   .htaccess GZIP
excerpt:     'Enable compression for other HTTP responses'
lead:        'Enable compression for other HTTP responses for the production environment.'
head:
  meta:
    - name: 'keywords'
      content: 'HTTP Auth, Apache config, apache2.conf, php, ssi, gzip'
---

<!-- TODO: Review by Infra. Quickly! -->

HTTP responses are compressed if the `content-type` header indicates a text document, for example `text/css` or `text/html`. To enable GZIP compression for other HTTP responses, like your REST or GraphQL APIs, use the `AddOutputFilterByType` directive:

```raw
AddOutputFilterByType DEFLATE application/json
```

## 1. Make sure environment variables are set

In the dashboard with your fortrabbit app environment, make sure an ENV var key-value pair like this is present:

```shell
ENVIRONMENT=production
```

In some cases we have pre-populated that for you already. See also our [environment variables article](/11.concepts/env-vars.md) for more details on how environment variables are handled here.

## 2. Setup .htaccess files

Now in the local code base of your project, setup a custom `.htaccess` file for each environment in the web root of your project:

* `.htaccess` in general and for local development
* `.htaccess_production` for your fortrabbit App

This can also be extended to more environments. All `.htaccess` files should be under version control with Git.

## 3. Configure Composer

Add this to the script part of your `composer.json` in your local code base:

```json
"scripts": {
  "post-install-cmd": [
    "@php -r \" define('HTSRC', 'web/.htaccess_' . getenv('ENVIRONMENT')); echo (file_exists(HTSRC) && copy(HTSRC, 'web/.htaccess')) ? HTSRC.' copied to web/.htaccess'.PHP_EOL : ''; \""
  ]
}
```

This Composer post install command will replace the contents of the `.htaccess` file with the contents of the file `.htaccess_production`, if that file is present and the environment variable `ENVIRONMENT` is set to `production`.

You can extend the concept to have more stages of course. To add custom rules for a staging environment. This example also assumes that the root path of your App is `web`. In the Composer example above, replace the `web` with the root path of your project.
