---
reviewed: 2025-01-13 17:08:03
title: Environment detection with .htaccess
navTitle: Environment detection
navigation.excerpt: Specific .htaccess rules for production / development
lead: You might want some `.htaccess` rules only to be applied in a certain environment. A common use case is that is to forward all traffic to HTTPS on your fortrabbit App in production, but not in your local development environment.
head:
  meta:
    - name: 'keywords'
      content: 'HTTP Auth, Apache config, apache2.conf, php, ssi, gzip'
---

## 1. Make sure environment variables are set

In the dashboard with your fortrabbit app environment, make sure an ENV var key-value pair like this is present:

```shell
ENVIRONMENT=production
```

In some cases we have pre-populated that for you already. See [environment variables topic](/3.dev/19.env-vars/1.intro.md/2.usage.md) for more details on how environment variables are handled here.

## 2. Setup .htaccess files

Now in the local code base of your project, setup a custom `.htaccess` file for each environment in the web root of your project:

- `.htaccess` in general and for local development
- `.htaccess_production` for your fortrabbit App

This can also be extended to more environments. All `.htaccess` files should be under version control with Git.

## 3. Configure Composer

Add this to the script part of your `composer.json` in your local code base:

```json
"scripts": {
  "post-install-cmd": [
    "@php -r \" define('HTSRC', 'web/.htaccess_' . getenv('ENVIRONMENT')); echo (file_exists(HTSRC) && copy(HTSRC, 'web/.htaccess')) ? HTSRC.' copied to web/.htaccess'.PHP_EOL : ''; \""
  ]
}
```

This Composer post install command will replace the contents of the `.htaccess` file with the contents of the file `.htaccess_production`, if that file is present and the environment variable `ENVIRONMENT` is set to `production`.

On fortrabbit, depending on build steps, usually each time you deploy with Git, composer install runs automatically.

You can extend the concept to have more stages of course (see our [multi staging article](//3.dev/15.learn/5.staging-environments.md)). To add custom rules for a staging environment, like http-auth (see [article](/3.dev/htaccess/3.http-auth.md)), create a matching `.htaccess_staging` file and set the `ENVIRONMENT` accordingly.

This also assumes that the root path of your App is `web`, which is true for Craft CMS. In the Composer example above, replace the `web` with the root path of your project.
