---
reviewed:         2023-05-18 07:01:13
title:            Laravel guide
naviTitle:        Laravel
excerpt:          The most PHPopular framework
lead:             Laravel is the most PHPopular framework. Learn how to install and tune Laravel on fortrabbit.
sidebar:          laravel
head:
  meta:
    - name: 'keywords'
      content: 'php, install, laravel, forge, ssh, git, hosting'
---



### Emoji support

Laravel uses the `utf8mb4` character set by default, which includes support for storing "emojis ðŸ”¥" in the database. You need to manually configure the default string length generated by migrations in order for MySQL to create indexes for them in your `AppServiceProvider`:

```php
use Illuminate\Support\Facades\Schema;

/**
 * Bootstrap any application services.
 *
 * @return void
 */
public function boot()
{
    Schema::defaultStringLength(191);
}
```

## Database import and export

There are various use cases for exporting and importing databases. Likely you want to:

1. Export the database from your old webhosting
2. Export your local database to import it to the fortrabbit database
3. Export the remote database from fortrabbit to bring your local installation up-to-date

Read on in the [MySQL article](/mysql) on how to do that and other tasks.

## Working with artisan migrate

If you are using the Universal Stack, you can log in to [SSH](ssh-uni) and execute `artisan` on the App (note that you'll need to call `artisan` via PHP: more on that [here](/quirks#need-to-call-via-php-interpreter)):

```bash
# login and execute
$ ssh {{ssh-user}}@deploy.{{region}}.frbit.com
$ php artisan migrate --force
```

If you are using the Universal or the Professional Stack, you can [execute remote commands via SSH](/remote-ssh-execution-pro). For example:

```bash
# remote execution
$ ssh {{ssh-user}}@deploy.{{region}}.frbit.com 'php artisan migrate --force'
```

**Note**: If `APP_ENV` is set to `production` - which is the default - the `--force` flag for migrate commands will override the confirmation prompt.

You can also add this command to your `composer.json` to have it run automatically every time you push changes.

```json
"scripts": {  
    "post-install-cmd": [
        "php artisan migrate --no-interaction --force",
    ],
}
```

With that in place, any time you deploy your code, database changes will be applied immediately. If no database changes are required, nothing happens, so it is safe to run all the time. Just make sure to test your upgrades and migrations locally first.

## Logging

You can access your logs via SSH or SFTP. Laravel, per default, stores it's log files in `storage/logs`. You can download them via SFTP from that folder. If you need to "tail" your logs live, you can:

```bash
# login via SSH
$ ssh {{ssh-user}}@deploy.{{region}}.frbit.com

# tail the logs
$ tail -f storage/logs/laravel.log
```

## User sessions

There are various session drivers available in Laravel. Read further to see which ones are most suitable for your App. Whichever driver you end up using, you will need to specify it in the environment variables. Add a new ENV var `SESSION_DRIVER` in the dashboard and give it the appropriate value.

Since fortrabbit app-environments have persistent storage, you are able to use the default `file` driver for sessions.

To use the `database` driver, follow these steps:

```bash
# Create a migration for the session table  - locally
$ php artisan session:table

# Apply the migration - locally
$ php artisan migrate

# Add, commit and push the migration file
$ git add .
$ git commit -m "session migration"
$ git push

# Run the migration on the App via SSH remote execution
$ ssh {{ssh-user}}@deploy.{{region}}.frbit.com php artisan migrate --force
```

## Queueing

Laravel supports multiple queue drivers. One which can be used with fortrabbit out of the box is `database`, which simply uses your database connection as a queue:

```bash
# Create a migration for the jobs table locally
php artisan queue:table 

# Apply the migration locally
$ php artisan migrate

# Add, commit and push the migration file
$ git add .
$ git commit -m "queue migration"
$ git push

# Run the migration on the App via SSH remote execution
$ ssh {{ssh-user}}@deploy.{{region}}.frbit.com php artisan migrate --force
```

That's great for small use-cases and tinkering, but if your App handles very many queue messages you should consider [Redis](#working-with-redis).

Once you've decided the queue you want to use, just open `config/queue.php` and set `default` to either `redis`, `database`, `sqs` - or even better: set the `QUEUE_CONNECTION` [environment variable](env-vars.md) accordingly in the Dashboard.

To run `php artisan queue:work` in the background, spin up a new [Worker](worker) and define the artisan command as a **Nonstop Job**.

**NB**: Laravel offers two commands to process queues: `queue:work` and `queue:listen`. We recommend using `queue:work`, and *not* using `queue:listen`. This is because the `queue:listen` command boots the Laravel framework for each iteration, whereas `queue:work` boots the framework once and runs as a daemon. Using `queue:work` offers high memory and performance gains in comparison with `queue:listen`.

## Using Vite

As of version 9, [Vite](https://vitejs.dev) replaces Mix as Laravel's default asset manager. Since fortrabbit does not provide a Node.js service, as with Mix you will need to compile your assets for production locally before deploying them to you App.

To get started, install Vite and the Laravel plugin:

```bash
npm install
```

After that, during local development, you can start the Vite dev server with

```bash
npm run dev
```

Your development asset files should be found in the locations specified in the `vite.config.js` file (by default 'resources/css/app.css' and 'resources/js/app.js').

When you are ready to deploy your assets, you must first build them for production locally with

```bash
npm run build
```

This will compile the assets and place them in a `build` folder in the `public` directory. This folder is by default excluded from the repo in `.gitignore`.

For more details on using Vite, see [Laravel's docs](https://laravel.com/docs/9.x/vite).

### Deploying assets with rsync

We recommend using `rsync`. The one-liner below works with the most common scenarios, but feel free to adjust it to your needs if your setup differs:

```bash
# Rsync command to sync the assets in your /public folder 
rsync -av ./public/build/ {{app-name}}@deploy.{{region}}.frbit.com:./public/build/
```

For your convenience you can define rsync command `npm run deploy-assets`. Example of `package.json`:

```json
{
  "scripts": {
    "deploy-assets": "rsync -av ...",
   }
}
```

### Migrating

If you want to migrate an existing project from Mix to Vite, Laravel has a [guide for that](https://github.com/laravel/vite-plugin/blob/main/UPGRADE.md#migrating-from-laravel-mix-to-vite). And if you've changed your mind, it has another guide for [migrating back from Vite to Mix](https://github.com/laravel/vite-plugin/blob/main/UPGRADE.md#migrating-from-vite-to-laravel-mix).

## Working with Redis

Redis can be used in Laravel as a cache or a queue or both. fortrabbit does not offer a Redis service of its own. To use Redis, you will need to book an externally-hosted Redis service. We have an article for [Redis Labs](/redis-cloud).

1. On the fortrabbit side, turn on the Redis extension in the Dashboard under App > Settings > PHP.
2. Then setup an Account with a Redis provider.
3. Then configure the redis database connection in `config/database.php`:

```php
// locally: use standards
$redis = [
    'host'     => env('REDIS_HOST', 'localhost'),
    'password' => env('REDIS_PASSWORD', null),
    'port'     => env('REDIS_PORT', 6379),
    'database' => 0,
];

// on fortrabbit: construct credentials from App secrets
if (getenv('APP_SECRETS')) {
    $secrets = json_decode(file_get_contents(getenv('APP_SECRETS')), true);
    $redis = [
        'host'     => $secrets['CUSTOM']['REDIS_HOST'],
        'port'     => $secrets['CUSTOM']['REDIS_PORT'],
        'password' => $secrets['CUSTOM']['REDIS_PASSWORD']
        'persistent' => 1
    ];
}

return [
    // other code â€¦
    'redis' => [
        'cluster' => false,
        'default' => $redis
    ],
    // other code â€¦
];
```

If you plan on using Redis as a cache, then open `config/cache.php` and set the `CACHE_DRIVER` [environment variable](env-vars.md) to `redis` in the Dashboard).

## Scheduling

The [Laravel scheduler](https://laravel.com/docs/9.x/scheduling) is not supported with the Universal Stack by design. The minimum time frame for standard cron jobs is 10 minutes here, but the Laravel scheduler requires a 1 minute schedule. Use the [Professional Stack](/app-pro) in combination with the [Workers Component](/worker-pro). That way your cron jobs will be outsourced to background processes.

## Using artisan down

`artisan down` generates the file `storage/framework/down`, which is then checked from your App's HTTP kernel with the `CheckForMaintenanceMode` middleware. Modifying files via [SSH remote execution](remote-ssh-execution-pro) only affects the deployment Node, not your live App. Any file changes via SSH remote exec do not affect your App.

There are at least two options to do this:

1. Add `artisan down` as a `post-install-cmd` script in `composer.json`, then `git push` (remove the command and push again to bring it back online)
2. Use a custom middleware and command which uses another source than a file, like `memcache` or `database`

## Using Laravel Envoy

Easy. Here is an `Envoy.blade.php` example:

```php
@servers(['fr' => '{{ssh-user}}@deploy.{{region}}.frbit.com'])

@task('ls', ['on' => 'fr'])
    ls -lha
@endtask

@task('migrate', ['on' => 'fr'])
    php artisan migrate
@endtask
```

Then execute locally:

```bash
envoy run ls
envoy run migrate
```

## Sending mail

You can not use [sendmail](quirks#mailing) on fortrabbit but Laravel provides an API over the popular SwiftMailer library. The mail configuration file is `app/config/mail.php`, and contains options allowing you to change your SMTP host, port, and credentials, as well as set a global form address for all messages delivered by the library.
